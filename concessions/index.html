
<!DOCTYPE html>
<html>
  <head>
	  <title>Africa Oil Concessions</title>


	   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />

 <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
 <script src="lib/leaflet.ajax.js"></script>
    <!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	  
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      html, body {
              height: 100%;
        /*margin: 0;
              padding: 0;*/

      }
    h2 {
           padding-bottom: 10px;
           }
    body{
                      padding-top: 10px;
}
    p,input {
       

      line-height: 120%;
      font-size: 14px;
           }
      #map {
        height: 527px;
      }

    #map-canvas {
    width:100%;
           height:500px;
    }


    /************************************************
*      4.      Navbar                                                          
        *

	    
	Navbar      								*
************************************************/


    
    </style>
  </head>
  <body>

	  <div class="container">
	 	  <div class="row">
			  <div class="col-md-1">
 		    <a href="https://openoil.net"><img src="https://openoil.net/wp/wp-content/uploads/2013/11/OpenOil-logo-2.jpg" width="60px"/></a>		    
			  </div>
			  <div class="col-md-11">
				 
<p ><a href="http://openoil.net/about-2/" target="_blank">About
us</a> | <a href="http://repository.openoil.net/wiki/Main_Page" target="_blank">Contracts
repository</a> | <a href="https://openoil-ug.github.io/tanzania/tanzania/en/" target="_blank">Open
data tour – Tanzania</a> | <a href="http://openoil.net/contract-modeling/" target="_blank">Public
interest financial modeling</a> | <a href="http://openoil.net/openoil-api/" target="_blank">open
API of world's oil concessions</a> | <a href="http://openoil.net/corporate-networks/bp-corporate-network/" target="_blank">mapping
Big Oil</a> (<a href="https://www.youtube.com/watch?v=29RQWlalFfs" target="_blank">video</a>)</p>
<p ><br/>

			  </div>
	    </div>

    <div class="row">
            <div class="col-md-5">
          <h2>Concession Blocks</h2>


			 
        </div>
        <div class="col-md-7">
		    <input id="searchTextField" type="text" size="50">
    <div id="map"></div>

        </div>



    </div>
</div>
<script>


	    var map = L.map('map').setView([4.22, 18.35], 3);
	filenames = [
		"AO_contracts.geojson",
		"BW.geojson",
		"CD_contracts.geojson",
		"CI.geojson",
		"CM.geojson",
		"ET.geojson",
		"GH_contracts+.geojson",
		"GQ_contracts+.geojson",
		"KE_contracts+.geojson",
		"LR_contracts+.geojson",
		"MG.geojson",
		"ML.geojson",
		"MR_contracts.geojson",
		"MW.geojson",
		"MZ.geojson",
		"NA_contracts.geojson",
		"NE.geojson",
		"NG_contracts+.geojson",
		"SC.geojson",
		"SL.geojson",
		"SN_contracts+.geojson",
		"SS.geojson",
		"ST.geojson",
		"TD_contracts.geojson",
		"TZ_contracts.geojson",
		"UG_contracts+.geojson",
		"ZA.geojson",
		"ZM.geojson"];


var choose_layers = function(){
	// collect filenames for countries
	all_countries = {};
	contracts_countries = {};
	contracts_plus_countries = {};
	filenames.forEach(function(fn){
		iso = fn.split('.')[0];
		all_countries[iso] = fn;
		if(fn.indexOf('contracts') != -1){
			contracts_countries[iso] = fn
		}
		if(fn.indexOf('contracts_') != -1){
			contracts_plus_countries[iso] = fn
		}
	});
	filepaths = []

	var queryDict = {}
location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]})
	// no 'c' parameter == return all countries	
	if('c' in queryDict){
		queryDict['c'].toUpperCase().split(',').forEach(
			function(n){
				if(n in all_countries){
					filepaths.push('data/' + all_countries[n]);
				}
				});
	}
	else{
		for(var key in all_countries){
			filepaths.push('data/' + all_countries[key]);
			}
	}
	return filepaths;		
}


	  var addLayer = function(layerid){	  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
		  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
		  maxZoom: 18,
		  id: layerid,
		  accessToken: 'pk.eyJ1Ijoib3Blbm9pbCIsImEiOiJVbzF0dUtjIn0.0PfhXizZ9_e1nLH1Dgye9A'
	  }).addTo(map);
	  }

	  mapbox_layers = [
		  'openoil.nklf1hg4', // base layer (terrain only)
	  ];
	  for(i=0;i<mapbox_layers.length;i++){
		  addLayer(mapbox_layers[i]);
	  }



			   
	  url_layers = choose_layers();
			   
	  var onEachFeature = function(feature, layer){
	      
			   
	      metadata_order = ['BlockID', 'Block_Name', 'Company', 'Status', 'Type', 'Contract', 'SourceURL', 'SourceDate', 'Timestamp'];
	      table_elements = [];

	      metadata_order.forEach(function(label){
		  value = feature.properties[label];
		  if(value){
		      table_elements.push([label, value]);
		  }
	      });
	      table = '<table>';

	      table_elements.forEach(function(e){
		  table += '<tr><td>' + e[0] + '</td><td>' + e[1] + '</td></tr>';
	      });
	      table += '</table>'
	      popupContent = feature.properties.BlockName;
	      
	      layer.bindPopup(table);
		  }
	  for(i=0;i<url_layers.length;i++){
		  var gjLayer = new L.GeoJSON.AJAX(url_layers[i],{
		   onEachFeature: onEachFeature});
		  gjLayer.addTo(map);
		  console.log('added a layer');
		  }
		  
		
	    </script>

  </body>
</html>
